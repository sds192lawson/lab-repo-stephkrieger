---
title: "Lab #3: Visualization Aesthetics (30 pts)"
author: "Steph Krieger"
format:
  html:
    code-fold: false
execute: 
  echo: true
knitr:
  opts_chunk: 
    message: false
editor: source
editor_options: 
  chunk_output_type: inline
---

## Introduction

Place necessary code (e.g. library and dataset loading) into the code chunk below:

```{r}
library(tidyverse)
library(RColorBrewer)
counties <- read_csv("https://raw.githubusercontent.com/sds-192-intro-fall22/sds-192-public-website-quarto/a8b64e3070ca2543b904d4d92780b09e6062ced6/website/data/nbi_counties.csv")
route_prefixes <- read_csv("https://raw.githubusercontent.com/sds-192-intro-fall22/sds-192-public-website-quarto/a8b64e3070ca2543b904d4d92780b09e6062ced6/website/data/nbi_route_pre.csv")
maintenance <- read_csv("https://raw.githubusercontent.com/sds-192-intro-fall22/sds-192-public-website-quarto/a8b64e3070ca2543b904d4d92780b09e6062ced6/website/data/nbi_maintenance.csv")
kinds <- read_csv("https://raw.githubusercontent.com/sds-192-intro-fall22/sds-192-public-website-quarto/a8b64e3070ca2543b904d4d92780b09e6062ced6/website/data/nbi_kind.csv")

nbi_ma <- read.delim("https://www.fhwa.dot.gov/bridge/nbi/2024/delimited/MA24.txt", sep = ",") |>
  left_join(counties) |>
  left_join(route_prefixes) |>
  left_join(maintenance) |>
  left_join(kinds) |>
  filter(SERVICE_ON_042A == 1) |>
  select(STRUCTURE_NUMBER_008, COUNTY_CODE_003_L, ROUTE_PREFIX_005B_L, MAINTENANCE_021_L, YEAR_BUILT_027, ADT_029, STRUCTURE_KIND_043A_L, STRUCTURAL_EVAL_067, BRIDGE_IMP_COST_094) |>
  mutate(STRUCTURE_KIND_043A_L = 
           case_when(
             STRUCTURE_KIND_043A_L == "Concrete continuous" ~ "Concrete",
             STRUCTURE_KIND_043A_L == "Steel continuous" ~ "Steel",
             STRUCTURE_KIND_043A_L == "Prestressed concrete continuous" ~ "Prestressed concrete",
             TRUE ~ STRUCTURE_KIND_043A_L)) |>
  mutate(BRIDGE_IMP_COST_094 = BRIDGE_IMP_COST_094 * 1000)

nbi_hampshire <- nbi_ma |> filter(COUNTY_CODE_003_L == "Hampshire")

rm(counties, kinds, maintenance, route_prefixes)
```


## Questions

::: {.callout-important}
###### Question 1 (3 pts)

In the code below, adjust the size to `2` and the alpha to `0.5`. Set the position to `"jitter"`. Note how this changes the plot.

Answer: When I changed the size to '2' the size of each point got bigger compared to when it was '1'. Additionally when I changed the alpha to '0.5', it made the saturation of the points lighter, this allows the viewer to clearly see where the data is clustered. For example, there seems to be a lot of bridges (points) built a little after 1950 with a structural evaluation of 5 or 6. This is harder to see when the alpha is at '1'.

```{r}
nbi_hampshire |>
  ggplot(aes(x = YEAR_BUILT_027, 
             y = STRUCTURAL_EVAL_067)) +
  geom_point(size = 2, alpha = 0.5, position = "identity") +
  labs(title = "Highway Bridge Conditions, Hampshire County, MA, 2024",
       x = "Year Built", 
       y = "Structural Evaluation") +
  theme_minimal()
```

:::

::: {.callout-important}
###### Question 2 (3 pts)

In the plot below, color the points on the plot with a qualitative palette by setting `col=` to the categorical variable `ROUTE_PREFIX_005B_L`. Remember that, in this case, color is an aesthetic, so this must be added inside of the `aes()` function. Add a label for the legend by setting `col=` in the `labs()` function to a phrase that describes the color variable.


```{r}
nbi_hampshire |>
  ggplot(aes(x = YEAR_BUILT_027, 
             y = STRUCTURAL_EVAL_067,
             col = ROUTE_PREFIX_005B_L)) +
  geom_point(size = 2, alpha = 0.5, position = "jitter") +
  labs(title = "Highway Bridge Conditions, Hampshire County, MA, 2024",
       x = "Year Built", 
       y = "Structural Evaluation",
       col = "Route Sign Prefix") +
  theme_minimal()
```

:::

::: {.callout-important}
###### Question 3 (3 pts)

Copy the completed plot from the last exercise below but swap out the variable you mapped to the color aesthetic with a numeric variable from the dataset. Be sure to also adjust the legend label. What kind of palette gets created? What new information do you gain about Hampshire County bridges from the plot? Note your interpretations in your quarto file. 

Answer: I chose to map the "ADT_O29" variable to the color aesthetic and it created a sequential palette because I mapped a numerical variable instead of a categorical variable. New information I gained was that there tends to be higher levels of traffic for bridges built around 1960 and 2020. 

```{r}
nbi_hampshire |>
  ggplot(aes(x = YEAR_BUILT_027, 
             y = STRUCTURAL_EVAL_067,
             col = ADT_029)) +
  geom_point(size = 2, alpha = 0.5, position = "jitter") +
  labs(title = "Highway Bridge Conditions, Hampshire County, MA, 2024",
       x = "Year Built", 
       y = "Structural Evaluation",
       col = "Average Daily Traffic Volume") +
  theme_minimal()
```

:::


::: {.callout-important}
###### Question 4 (3 pts)

In the plot below, assign the shape of the data on the plot by setting `shape=` to the categorical variable `STRUCTURE_KIND_043A_L`. Remember that, in this case, shape is an aesthetic, so this must be added inside of the `aes()` function. Add a label for the legend by setting `shape=` in the `labs()` function to a phrase that describes the shape variable.

```{r}
nbi_hampshire |>
  ggplot(aes(x = YEAR_BUILT_027, 
             y = STRUCTURAL_EVAL_067,
             shape = STRUCTURE_KIND_043A_L)) +
  geom_point(size = 2, alpha = 0.5, position = "jitter") +
  labs(title = "Highway Bridge Conditions, Hampshire County, MA, 2024",
       x = "Year Built", 
       y = "Structural Evaluation",
       shape = "Type of Material/Design for Structure") +
  theme_minimal()
```


:::

::: {.callout-important}
###### Question 5 (3 pts)

Copy one of your plots from above, and inside the `aes()` function, set `size=` to a numeric variable not already represented on the plot. Keep in mind that you'll need to remove the `size=` *attribute* from `geom_point()` for the points to size correctly. Be sure to also adjust the legend labels. What new information do you gain about Hampshire County bridges from the plot?

Answer: New information I gained from this plot about Hampshire County bridges is that bridges built around 1960 made with either steel or concrete tend to average more traffic per day compared to bridges from 1960 made with wood, masonry, or prestressed concrete.

```{r}
nbi_hampshire |>
  ggplot(aes(x = STRUCTURE_KIND_043A_L, 
             y = YEAR_BUILT_027, 
             size = ADT_029)) +
  geom_point(alpha = 0.5, position = "jitter") +
  coord_flip() +
  labs(title = "Highway Bridge Conditions, Hampshire County, MA, 2024",
       x = "Type of Material/Design for Structure", 
       y = "Year Built",
       size = "Average Daily Traffic Volume") +
  theme_minimal() +
  theme(legend.position = "bottom")
```


:::

::: {.callout-important}
###### Question 6 (3 pts)

In the plot below, change the y-axis scale from `continuous` to `log10`. You might reference the formula specified above or reference the ggplot cheatsheet for help. Note that your y-axis will appear in scientific notation. Convert it to comma notation by adding: `labels = scales::comma` as an argument in the scale function call.

```{r}
nbi_ma |>
  ggplot(aes(x = YEAR_BUILT_027, 
             y = BRIDGE_IMP_COST_094)) +
  geom_point(size = 1, alpha = 0.5, position = "jitter") +
  labs(title = "Highway Bridge Conditions, MA, 2024",
       x = "Year Built", 
       y = "Bridge Improvement Costs") +
  theme_minimal() + 
  scale_y_log10(labels = scales::comma)
```

:::

::: {.callout-important}
###### Question 7 (3 pts)

The Interstate Highway Act of 1956 (signed under Dwight D. Eisenhower) established the U.S.'s interstate highway system and is considered the country's largest public works project. Adjust the x-axis scale of the plot below to help tell this story. Specifically, bin years into before 1954 (when Eisenhower was elected) and 1954-2021. Set the label at 1954 to "Eisenhower Elected" and the label at 2021 to "Today."

```{r}
nbi_ma |>
  ggplot(aes(x = YEAR_BUILT_027, 
             y = ROUTE_PREFIX_005B_L)) +
  geom_point(size = 1, alpha = 0.2, position = "jitter") +
  labs(title = "Highway Bridge Conditions, MA, 2024",
       x = "Year Built", 
       y = "Route Prefix") +
  theme_minimal() +
  scale_x_binned(breaks = c(1954, 2021), labels = c("Eisenhower Elected", "Today"))
```


:::


::: {.callout-important}
###### Question 8 (3 pts)

Add \``` + scale_color_brewer()` `` to the `ggplot()` object below and assign a categorical palette. Refer to the ggplot cheatsheet or the help pages for help with formatting the function call.

```{r}
nbi_hampshire |>
  ggplot(aes(x = YEAR_BUILT_027, 
             y = STRUCTURAL_EVAL_067,
             col = ROUTE_PREFIX_005B_L)) +
  geom_point(size = 2, alpha = 0.5, position = "jitter") +
  scale_color_brewer(palette = "Set2") +
  labs(title = "Highway Bridge Conditions, Massachusetts, 2024",
       x = "Year Built", 
       y = "Structural Evaluation",
       col = "Route Prefix") +
  theme_minimal()
```

:::

::: {.callout-important}
###### Question 9 (3 pts)

Add \``` + scale_color_distiller()` `` to the `ggplot()` object below and assign a sequential palette. By default the colors will be ordered from darkest to lightest. Add an argument to the function call to reverse the direction of the colors. Refer to the ggplot cheatsheet or the help pages for help with formatting the function call.

```{r}
nbi_hampshire |>
  ggplot(aes(x = YEAR_BUILT_027, 
             y = STRUCTURAL_EVAL_067,
             col = ADT_029)) +
  geom_point(size = 2, alpha = 0.5, position = "jitter") +
  labs(title = "Highway Bridge Conditions, MA, 2024",
       x = "Year Built", 
       y = "Structural Evaluation",
       col = "Average Daily Traffic") +
  theme_minimal() +
  scale_color_distiller(palette = "Blues", direction = 1)
```


:::

::: {.callout-important}
###### Question 10 (3 pts)

Facet the plot below by `STRUCTURE_KIND_043A_L` to see the degree of structural deficiencies for different kinds of highway bridges of different ages in Massachusetts.

```{r}
nbi_ma |>
  ggplot(aes(x = YEAR_BUILT_027, 
             y = STRUCTURAL_EVAL_067)) +
  geom_point(alpha = 0.1, size = 0.5, position = "jitter") +
  labs(title = "Highway Bridge Conditions, MA 2024",
       x = "Year Built", 
       y = "Structural Evaluation") +
  theme_minimal() +
  facet_wrap(vars(STRUCTURE_KIND_043A_L))
```

:::

::: callout-caution
## Ethical Considerations
Federal regulations require that highway bridges and public road bridges in the United States must be inspected every two years, and bridge inspectors must follow a strict set of guidelines when performing a bridge inspection. If a bridge is discovered to have certain structural deficiencies, it may be shut down or may require more frequent inspections. Despite these widespread safety standards, we still sometimes see catastrophic bridge failures or discover critical bridge conditions that could potentially put lives at risk. This could result from human error, low vigilance or attention to detail during inspections, lack of understanding/adherence to inspection standards, or inspection equipment malfunctions. What kinds of interventions do you think should be put in place to ensure the accountability of bridge inspection data? What kinds of policies, practices, or programs could help to minimize mistakes or encourage that mistakes be fixed promptly? Share your ideas on our `discussions` Slack channel.
:::
